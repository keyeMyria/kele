<!doctype html>
<html lang="en">
{% load static %}
<head>
    <meta charset="UTF-8">
    <title>宠粮定制</title>
    <link rel="stylesheet" href="{% static 'wxchat/style/style.css' %}">

</head>
<body>
<div class="container">
    {% for i in order %}
        {% if forloop.first == True %}
            <ul class="question show" id="question_1">

                <h3>{{ i.name }}</h3>
                {% for s in i.dogstatustype.all %}
                    <li data-answer="{{ s.name }}">{{ s.name }}</li>
                {% endfor %}


            </ul>
        {% elif not forloop.last and not forloop.first %}

            <ul class="question" id="question_{{ forloop.counter }}">

                <h3>{{ i.name }}</h3>
                {% for s in i.dogstatustype.all %}
                    <li data-answer="{{ s.name }}">{{ s.name }}</li>
                {% endfor %}
            </ul>
        {% else %}
            {% if forloop.last %}
                <ul class="question" id="question_{{ i.id }}">

                    <h3>{{ i.name }}</h3>
                    {% for s in i.dogstatustype.all %}
                        <li data-answer="{{ s.name }}">{{ s.name }}</li>
                    {% endfor %}
                    <div class="btn_box">
                        <a href="javascript:void(0);" class="submit" onclick="submitPage()">提交</a>
                    </div>
                </ul>
            {% endif %}
        {% endif %}
    {% endfor %}
    <div class="btn_box">
        <a href="javascript:void(0);" class="previous_page hide">上一页</a>

    </div>

</div>
<script src="{% static 'wxchat/js/jquery.min.js' %}"></script>
<script>
    $(function () {
        $(".question>li").on("click", function () {
            var len = $(".container>ul").size();
            var idx = $(this).parent().attr("id");
            idx = idx.split('_')[1];
            var idx2 = idx * 1 + 1;
            $(this).addClass("answer").siblings("li").removeClass("answer");
            setTimeout(function () {
                if (idx == len) {
                    return false;
                } else {
                    $("#question_" + idx + "").hide();
                    $("#question_" + idx2 + "").show();
                }
            }, 500)


        })
        $(".previous_page").on("click", function () {
            var idx = $(".question:visible").attr("id");
            idx = idx.split('_')[1];
            var idx2 = idx - 1;
            $("#question_" + idx + "").hide();
            $("#question_" + idx2 + "").show();
            if ($("#question_1").is(":visible")) {
                $(this).hide();
            }
        });
        $("#question_1>li").on("click", function () {
            setTimeout(function () {
                $(".previous_page").show();
            }, 500)
        })


    });

    function submitPage() {
        var a = [];
        {#        a.push($(".question>li.answer").text())#}
        $(".question>li.answer").each(function () {
            var answers = $(this).data('answer');
            a.push(answers)
        });
        {#        alert(a);#}
        $.ajax({

            url: "{% url 'dog-order' %}",  //请求服务的地址

            type: "GET",  //数据发送的方式

            contentType: "application/jason; encode=utf-8",  // 发送的数据及data对应数据的类型，前者是POST方式，后者是GET方式

            data: {'alldata': JSON.stringify(a)},

            success: function (data) {
                window.location.href = "{% url 'order-success'%}?peice=" + data['peice'] + '&skin_status=' + data['skin_status'] + '&eye_status=' + data['eye_status'] + '&dogtype=' + data['dogtype'] + '&dog_age=' + data['dog_age'] + '&body_status=' + data['body_status'] + '&bones_status=' + data['bones_status'] + '&dog_code=' + data['dog_code'];
                //ret_data是ajax发送成功后，后端服务器HttpResponse（）返回的数据

            }

        });
    }
</script>

</body>
</html>